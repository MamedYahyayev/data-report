<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Report</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <link href="../static/css/bootstrap.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="container-fluid bg-secondary text-white p-3 text-center">
    <h1>Welcome to Data Report Web Application</h1>
    <p>
        Data Report scrape data from the webpages and store them into different
        files.
    </p>
</div>

<div class="row-cols-3 d-flex align-content-start justify-content-center mt-5 p-3 gap-2">
    <div class="border border-2 border-light-subtle bg-white shadow-lg p-3">
        <h1>File properties</h1>
        <div class="mt-5 d-flex flex-column">
            <label class="fs-5 mb-2">Title</label>
            <input type="text" class="form-control" name="title of config file"
                   aria-describedby="title" placeholder="Enter title">
        </div>

        <div class="mt-4 d-flex flex-column">
            <label class="fs-5 mb-2">Description</label>
            <textarea class="form-control" name="description of config file" rows="3"
                      aria-describedby="description" placeholder="Enter description"></textarea>
        </div>

        <div class="mt-4 d-flex flex-column">
            <label class="fs-5 mb-2">File Type</label>
            <select class="form-control" name="file type">
                <option>Not Set</option>
                <option>Excel</option>
            </select>
        </div>

        <div class="mt-4 d-flex flex-column">
            <label class="fs-5 mb-2">File Extension</label>
            <select class="form-control" name="file extension">
                <option>Not Set</option>
                <option>.xlsx</option>
            </select>
        </div>
    </div>
    <div class="border border-2 border-light-subtle bg-white shadow-lg p-3" id="data-prop-section">
        <h1>Data Properties</h1>
        <div class="mt-4 d-flex flex-column">
            <label class="fs-5 mb-2">Name</label>
            <input type="text" class="form-control" name="name of data element" id="data-element-name"
                   aria-describedby="name" placeholder="Enter name of data element">
        </div>

        <div class="mt-4 d-flex flex-column">
            <label class="fs-5 mb-2">CSS Selector</label>
            <input type="text" class="form-control" name="selector of data element" id="data-element-selector"
                   aria-describedby="selector" placeholder="Enter CSS selector">
        </div>

        <div class="mt-4 form-group form-check">
            <input type="checkbox" class="form-check-input" id="has-children">
            <label class="form-check-label" for="has-children">Element has children?</label>
        </div>

        <div class="mt-4 d-flex flex-column d-none" id="children-selection">
            <label class="fs-5 mb-2">Children</label>
            <select class="form-control" name="file extension">
                <option>Not Set</option>
            </select>
        </div>
        <div class="float-end mt-4">
            <button class="btn btn-success" id="add-element-btn">Add element</button>
        </div>
    </div>
    <div class="border border-2 border-light-subtle bg-white shadow-lg p-3" style="max-height: 650px;">
        <h1>HTML Elements</h1>
        <div class="mt-2 d-flex flex-column">
            <label class="fs-5 mb-2">URL</label>
            <input type="text" class="form-control" name="url of page" id="url"
                   aria-describedby="URL" placeholder="Enter URL">
        </div>
        <div class="overflow-auto mt-3" style="max-height: 400px;" id="html-element-section">
        </div>
        <div class="float-end mt-4">
            <button class="btn btn-success" id="generate-report-btn">Generate Report</button>
        </div>
    </div>
</div>

<script src="../static/js/dataElement.js"></script>
<script>
    const hasChildrenCheck = document.querySelector("#has-children");
    const childrenSelectionArea = document.querySelector("#children-selection");
    const addElementBtn = document.querySelector("#add-element-btn")
    const generateReportBtn = document.querySelector("#generate-report-btn")
    const htmlElementsSection = document.querySelector("#html-element-section");

    hasChildrenCheck.addEventListener("click", (e) => {
        const isChecked = e.target.checked;

        if (isChecked) {
            childrenSelectionArea.classList.remove("d-none");
            populateChildrenElementSelection();
        } else {
            childrenSelectionArea.classList.add('d-none');
        }
    });

    function populateChildrenElementSelection() {
        const childrenSelect = childrenSelectionArea.lastElementChild;
        clearChildrenElementSelection();

        const notSetOption = document.createElement("option");
        notSetOption.textContent = "NOT SET";
        childrenSelect.appendChild(notSetOption);

        const htmlElements = htmlElementsSection.children;
        if (htmlElements.length === 0) {
            return;
        }

        for (const element of htmlElements) {
            const childOption = document.createElement("option");
            childOption.textContent = element.firstChild.childNodes[0].nodeValue;

            childrenSelect.appendChild(childOption);
        }
    }

    function clearChildrenElementSelection() {
        const childrenSelect = childrenSelectionArea.lastElementChild;
        let first = childrenSelect.firstChild
        while (first) {
            first.remove();
            first = childrenSelect.firstChild;
        }
    }

    addElementBtn.addEventListener("click", () => {
        const elementName = document.querySelector("#data-element-name").value;
        const elementSelector = document.querySelector("#data-element-selector").value;

        const dataElement = new DataElement(elementName, elementSelector);
        const htmlElement = dataElement.constructElement();

        htmlElementsSection.appendChild(htmlElement);
    })

    generateReportBtn.addEventListener("click", (e) => {
        console.log(e);
    })

</script>
</body>
</html>